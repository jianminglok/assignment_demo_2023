// Auto-generated by the postman-to-k6 converter

import "../libs/shim/core.js";
const { sentence } = require('https://unpkg.com/txtgen/dist/cjs/txtgen.js')

const names = [
  "Randell:Margi", "Dalt:Ripley", "Ramsay:Arne", "Issi:Stefa", "Ivy:Adair", "Erl:Adams", 
  "Rudie:Faustine", "Arlana:Giustina", "Mendy:Angelique", "Kania:Ingeberg", "Ree:Dani", "Angeline:Joann", 
  "Rosanne:Rad", "Corena:Dell", "Stevie:Omero", "Laureen:Kiri", "Elise:Yule", "Chrissy:Julio", "Maegan:Monro", "Hadley:Lucienne"
]

function randomInteger(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

export let options = {
  scenarios: {
    contacts: {
      executor: 'ramping-arrival-rate',

      // Start iterations per `timeUnit`
      startRate: 1,

      // Start `startRate` iterations per minute
      timeUnit: '5s',

      // Pre-allocate necessary VUs.
      preAllocatedVUs: 20,
      maxVUs: 200,

      stages: [
        { target: 5, duration: '0.25m' },
        { target: 150, duration: '0.25m' },
        { target: 750, duration: '1m' },
        { target: 300, duration: '0.25m' },
      ],
    },
  },
  thresholds: {
    http_req_duration: ['p(95)<100'], // 95% of requests should be below 100ms
  },
};

const Request = Symbol.for("request");
postman[Symbol.for("initial")]({
  options
});

export default function() {
  var currentChat = names[randomInteger(0, 19)]
  var currentSender = currentChat.split(":")[randomInteger(0, 1)]
  postman[Request]({
    name: "POST REQUEST",
    id: "af931f0e-792c-4679-bb30-7f9b246b0678",
    method: "POST",
    address: "http://localhost:8080/api/send",
    data:
      '{\r\n    "chat":"' + currentChat + '",\r\n    "text":"' + sentence() + '",\r\n    "sender":"' + currentSender + '"\r\n}',
    headers: {
      "Content-Type": "application/json"
    }
  });
}
